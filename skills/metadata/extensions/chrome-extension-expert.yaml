# Chrome Extension Expert - OPUS 67 v4.0
# Browser extension development

id: chrome-extension-expert
name: "Chrome Extension Expert"
tier: 2
token_cost: 6000
version: "1.0.0"

semantic:
  purpose: "Build Chrome extensions with Manifest V3"

  what_it_does:
    - "Configure manifest.json for V3"
    - "Create service workers (background scripts)"
    - "Implement content scripts for page injection"
    - "Build popup and options pages"
    - "Use Chrome Storage API"
    - "Handle permissions and messaging"

  what_it_cannot:
    - "Access arbitrary websites without permissions"
    - "Run indefinitely (service workers timeout)"

capabilities:
  - action: "Manifest V3 config"
    confidence: 0.92
  - action: "Content scripts"
    confidence: 0.90
  - action: "Chrome APIs"
    confidence: 0.88

auto_load_when:
  keywords:
    - chrome extension
    - manifest.json
    - content script
    - service worker extension
    - chrome.runtime
    - chrome.storage

anti_hallucination:
  - trigger: "manifest v2|background page"
    response: "Manifest V2 is deprecated. Use V3 with service workers instead of persistent background pages."

synergies:
  amplifying: [react-expert, typescript-senior]
  conflicting: []
  redundant: []

mcp_connections: []

code_patterns:
  manifest: |
    // manifest.json (Manifest V3)
    {
      "manifest_version": 3,
      "name": "My Extension",
      "version": "1.0.0",
      "description": "A helpful Chrome extension",
      "permissions": ["storage", "activeTab", "scripting"],
      "host_permissions": ["https://*.example.com/*"],
      "action": {
        "default_popup": "popup.html",
        "default_icon": {
          "16": "icons/icon16.png",
          "48": "icons/icon48.png",
          "128": "icons/icon128.png"
        }
      },
      "background": {
        "service_worker": "background.js",
        "type": "module"
      },
      "content_scripts": [
        {
          "matches": ["https://*.example.com/*"],
          "js": ["content.js"],
          "css": ["content.css"]
        }
      ],
      "options_page": "options.html"
    }

  service_worker: |
    // background.js (service worker)
    chrome.runtime.onInstalled.addListener(() => {
      console.log("Extension installed");
      chrome.storage.local.set({ enabled: true });
    });

    // Listen for messages from content scripts
    chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
      if (message.type === "GET_DATA") {
        chrome.storage.local.get(["userData"], (result) => {
          sendResponse({ data: result.userData });
        });
        return true; // Keep channel open for async response
      }
    });

    // Context menu
    chrome.contextMenus.create({
      id: "myExtension",
      title: "Process with My Extension",
      contexts: ["selection"],
    });

    chrome.contextMenus.onClicked.addListener((info, tab) => {
      if (info.menuItemId === "myExtension") {
        chrome.tabs.sendMessage(tab.id, {
          type: "PROCESS_SELECTION",
          text: info.selectionText,
        });
      }
    });

  content_script: |
    // content.js
    // Runs in the context of web pages

    // Inject UI
    const container = document.createElement("div");
    container.id = "my-extension-root";
    document.body.appendChild(container);

    // Listen for messages from background
    chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
      if (message.type === "PROCESS_SELECTION") {
        processSelectedText(message.text);
      }
    });

    // Send message to background
    async function getData() {
      const response = await chrome.runtime.sendMessage({ type: "GET_DATA" });
      return response.data;
    }
